<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XRD Peak Toolkit</title>

<link rel="icon" type="image/png" href="../../../favicon1.png">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{
  --text:#e8eefc;
  --muted:rgba(232,238,252,.75);
  --border:rgba(255,255,255,.14);
  --border2:rgba(255,255,255,.18);
  --accent:#60a5fa;
}

body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#070a14,#0b1020);
  color:var(--text);
  font-size:16px; /* slightly larger base */
}

.wrap{max-width:1160px;margin:0 auto;padding:22px;}

h1{
  margin:0 0 6px;
  font-size:26px;
  font-weight:600;
}

.sub{
  color:var(--muted);
  margin:0 0 16px;
  font-size:16px;
}

.grid{display:grid;grid-template-columns:1fr;gap:14px;}
@media (min-width:980px){.grid{grid-template-columns:420px 1fr;}}

.card{
  background:rgba(255,255,255,.06);
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:0 18px 50px rgba(0,0,0,.35);
  padding:16px;
}

.topbar{display:flex;justify-content:flex-end;margin-bottom:10px;}

.pill{
  font-size:14px;
  font-weight:500;
  border:1px solid rgba(255,255,255,.14);
  padding:8px 13px;
  border-radius:999px;
  background:rgba(0,0,0,.14);
}

label{
  display:block;
  font-size:14px;
  color:var(--muted);
  margin:12px 0 6px;
}

select,input{
  width:100%;
  padding:12px 40px 12px 12px;
  border-radius:14px;
  border:1px solid var(--border2);
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.12));
  color:var(--text);
  font-size:15px;
}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

canvas{
  width:100%;
  height:320px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(0,0,0,.18);
}

.below-plot{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:8px;
}

.pager{
  display:flex;
  gap:10px;
  align-items:center;
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  padding:7px 12px;
  background:rgba(0,0,0,.10);
}

.pager button{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.18);
  color:var(--text);
  border-radius:10px;
  padding:7px 11px;
  font-size:14px;
}

.refline{font-size:14px;}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:14px;
  font-size:15px;
}

th,td{
  padding:12px 8px;
  border-bottom:1px solid rgba(255,255,255,.10);
}

th{
  text-align:left;
  color:var(--muted);
  font-weight:600;
}
</style>
</head>

<body>
<div class="wrap">
<h1 id="pageTitle">XRD 2θ–ω Peak Toolkit</h1>
<p class="sub" id="pageIntro">Interactive quick reference for XRD peaks (from Excel).</p>

<div class="grid">
<div class="card">
<div class="topbar">
<span class="pill" id="updatePill">Updated: —</span>
</div>

<label>Beam Type</label>
<select id="dbSel"></select>

<label>Material</label>
<select id="materialSel"></select>

<label>Orientation</label>
<select id="orientSel"></select>

<div class="row">
<div>
<label>2θ min</label>
<input id="xmin" type="number" value="10"/>
</div>
<div>
<label>2θ max</label>
<input id="xmax" type="number" value="100"/>
</div>
</div>
</div>

<div class="card">
<canvas id="plot" width="1400" height="560"></canvas>

<div class="below-plot">
<div class="refline" id="refWrap">—</div>
<div class="pager">
<button id="prevPaper">&lt;</button>
<span id="paperIdx">1 / 1</span>
<button id="nextPaper">&gt;</button>
</div>
</div>

<table>
<thead>
<tr>
<th>2θ (degrees)</th>
<th>Miller indices (hkl)</th>
</tr>
</thead>
<tbody id="peakTable"></tbody>
</table>
</div>
</div>
</div>

<script>
const DB_FILES=[{id:"cu",label:"Cu Kα",file:"xrd_peaks_cu_ka.xlsx"}];
let STORE=null,paperIndex=0;

function drawPlot(peaks){
const c=document.getElementById("plot");
const ctx=c.getContext("2d");
ctx.clearRect(0,0,c.width,c.height);

ctx.font="22px system-ui";
ctx.fillText("Intensity (arb. units)",40,120);

ctx.font="22px system-ui";
ctx.fillText("2θ (degrees)",600,520);

ctx.strokeStyle="#60a5fa";
ctx.lineWidth=2.5;
ctx.beginPath();
ctx.moveTo(100,500);
ctx.lineTo(1300,500);
ctx.stroke();
}

function updateBeamLabel(meta){
const opt=document.querySelector("#dbSel option");
opt.textContent=`Cu Kα (λ = ${meta.wavelength_angstrom} Å)`;
}

async function loadExcel(file){
const res=await fetch(file);
const buf=await res.arrayBuffer();
const wb=XLSX.read(buf,{type:"array"});

const meta=XLSX.utils.sheet_to_json(wb.Sheets.meta)[0];
STORE=meta;

document.getElementById("updatePill").textContent=
`Updated: ${meta.db_last_updated}`;

updateBeamLabel(meta);
drawPlot([]);
}

loadExcel("xrd_peaks_cu_ka.xlsx");
</script>
</body>
</html>
