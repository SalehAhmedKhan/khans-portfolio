<!-- File: journal.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading…</title>

  <link rel="icon" type="image/png" href="../../favicon1.png" />

  <style>
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      color:#f5f5f5;

      --g1: rgba(80,120,255,0.12);
      --g2: rgba(0,200,180,0.08);
      --bgA: #0b0f1a;
      --bgB: #111827;
      --bgC: #0a0e17;

      background:
        radial-gradient(circle at 18% 20%, var(--g1), transparent 42%),
        radial-gradient(circle at 82% 28%, var(--g2), transparent 46%),
        linear-gradient(135deg, var(--bgA), var(--bgB) 62%, var(--bgC));
      background-attachment: fixed;
    }

    header{
      padding: 2rem 1.5rem 1rem;
      text-align: center;
    }

    header h1{
      margin: 0 0 0.5rem 0;
      font-size: 2rem;
      font-weight: 650;
      letter-spacing: 0.2px;
    }

    header p{
      margin: 0;
      opacity: 0.9;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .container{
      max-width: 1100px;
      margin: 1.25rem auto 2.5rem;
      padding: 0 1.5rem;
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1.25rem;
      align-items: start;
    }

    @media (max-width: 960px){
      .container{
        grid-template-columns: 1fr;
      }
    }

    .panel{
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
      backdrop-filter: blur(6px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.28);
    }

    .panel h2{
      margin: 0 0 0.75rem 0;
      font-size: 1.25rem;
      font-weight: 650;
    }

    .papers{
      display: grid;
      gap: 1rem;
    }

    .paper-card{
      background: rgba(255,255,255,0.14);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 12px;
      padding: 1rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.22);
    }

    .paper-top-row{
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.65rem;
      font-size: 0.86rem;
      opacity: 0.95;
    }

    .paper-date{
      font-weight: 700;
      letter-spacing: 0.2px;
      opacity: 0.92;
      white-space: nowrap;
    }

    .paper-link a{
      color: #9fc9ff;
      font-weight: 700;
      text-decoration: none;
    }

    .paper-link a:hover{
      text-decoration: underline;
    }

    .paper-gist{
      margin: 0 0 0.5rem 0;
      font-size: 1.05rem;
      font-weight: 800;
      line-height: 1.25;
    }

    .paper-title{
      margin: 0 0 0.6rem 0;
      opacity: 0.9;
      line-height: 1.35;
    }

    .paper-authors{
      margin: 0;
      opacity: 0.9;
      font-size: 0.92rem;
      line-height: 1.35;
    }

    .paper-affil{
      margin: 0.25rem 0 0;
      opacity: 0.85;
      font-size: 0.9rem;
      line-height: 1.35;
    }

    .paper-tags{
      display:flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.85rem;
    }

    .tag{
      font-size: 0.78rem;
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.10);
      opacity: 0.95;
      white-space: nowrap;
    }

    .log-help{
      margin: 0 0 0.75rem 0;
      opacity: 0.85;
      font-size: 0.9rem;
      line-height: 1.35;
    }

    .log-list{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.55rem;
    }

    .log-item{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.06);
      border-radius: 10px;
      padding: 0.6rem 0.7rem;
      display: grid;
      grid-template-columns: 105px 1fr;
      gap: 0.75rem;
      align-items: start;
    }

    .log-item.latest{
      border-color: rgba(159, 201, 255, 0.20);
      background: rgba(159, 201, 255, 0.06);
    }

    .log-date{
      font-size: 0.82rem;
      font-weight: 800;
      opacity: 0.92;
      white-space: nowrap;
    }

    .log-text{
      font-size: 0.9rem;
      opacity: 0.92;
      line-height: 1.35;
    }

    .back-wrap{
      display:flex;
      justify-content:center;
      margin: 1.25rem 0 2rem;
      padding: 0 1.5rem;
    }

    a.back-btn{
      display:inline-block;
      text-decoration:none;
      font-weight:700;
      color:#eaf2ff;
      background: rgba(159,201,255,0.16);
      border: 1px solid rgba(159,201,255,0.28);
      padding: 0.8rem 1.2rem;
      border-radius: 12px;
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
    }

    a.back-btn:hover{
      border-color: rgba(159,201,255,0.42);
      background: rgba(159,201,255,0.22);
    }

    .load-error{
      background: rgba(255, 80, 80, 0.12);
      border: 1px solid rgba(255, 80, 80, 0.25);
      border-radius: 12px;
      padding: 1rem;
      margin: 1.25rem 0;
    }
  </style>
</head>
<body>

<header>
  <h1 id="page-title">Loading…</h1>
  <p id="page-intro">Loading…</p>
</header>

<div class="container" id="root">
  <main>
    <div class="panel">
      <h2>Journal Entries</h2>
      <div class="papers" id="papers"></div>
    </div>
  </main>

  <aside class="sidebar">
    <div class="panel">
      <h2>Update log</h2>
      <p class="log-help">
        Latest updates appear at top. Edit manually as you add more papers.
      </p>
      <ul class="log-list" id="log-list"></ul>
    </div>
  </aside>
</div>

<div class="back-wrap">
  <a class="back-btn" href="../../index.html">Back to my Portfolio</a>
</div>

<script>
  function hash32(str){
    let h = 0x811c9dc5;
    for(let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 0x01000193);
    }
    return h >>> 0;
  }

  function mulberry32(seed){
    let t = seed >>> 0;
    return function(){
      t += 0x6D2B79F5;
      let x = Math.imul(t ^ (t >>> 15), 1 | t);
      x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
      return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
    };
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function rgba(r,g,b,a){ return `rgba(${r|0},${g|0},${b|0},${a})`; }
  function hexFromRGB(r,g,b){
    const toHex = n => n.toString(16).padStart(2,"0");
    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
  }

  function applySeededBackground(title){
    const seed = hash32(title || "Journal");
    const rand = mulberry32(seed);

    const r1 = clamp(35 + Math.floor(140 * rand()), 35, 185);
    const g1 = clamp(35 + Math.floor(140 * rand()), 35, 185);
    const b1 = clamp(35 + Math.floor(140 * rand()), 35, 200);

    const r2 = clamp(25 + Math.floor(150 * rand()), 25, 200);
    const g2 = clamp(25 + Math.floor(150 * rand()), 25, 210);
    const b2 = clamp(25 + Math.floor(150 * rand()), 25, 210);

    const base1 = { r: 7 + Math.floor(12 * rand()),  g: 9 + Math.floor(16 * rand()),  b: 16 + Math.floor(18 * rand()) };
    const base2 = { r: 10 + Math.floor(16 * rand()), g: 14 + Math.floor(20 * rand()), b: 26 + Math.floor(22 * rand()) };
    const base3 = { r: 6 + Math.floor(12 * rand()),  g: 8 + Math.floor(14 * rand()),  b: 14 + Math.floor(18 * rand()) };

    document.body.style.setProperty("--g1", rgba(r1,g1,b1,0.12));
    document.body.style.setProperty("--g2", rgba(r2,g2,b2,0.08));
    document.body.style.setProperty("--bgA", hexFromRGB(base1.r, base1.g, base1.b));
    document.body.style.setProperty("--bgB", hexFromRGB(base2.r, base2.g, base2.b));
    document.body.style.setProperty("--bgC", hexFromRGB(base3.r, base3.g, base3.b));
  }

  function el(tag, className, text){
    const n = document.createElement(tag);
    if(className) n.className = className;
    if(text !== undefined && text !== null) n.textContent = text;
    return n;
  }

  function paperCard(p){
    const card = el("article", "paper-card");

    const main = el("div", "paper-main");
    const top = el("div", "paper-top-row");

    top.appendChild(el("span", "paper-date", p.publishedDate || ""));

    const linkWrap = el("span", "paper-link");
    const a = document.createElement("a");
    a.href = p.link || "#";
    a.target = "_blank";
    a.rel = "noopener";
    a.textContent = "Journal page";
    linkWrap.appendChild(a);
    top.appendChild(linkWrap);

    main.appendChild(top);
    main.appendChild(el("h3", "paper-gist", p.gist || ""));
    main.appendChild(el("p", "paper-title", p.title || ""));

    const authorsLine = [p.firstAuthor, "et al.", "—", p.group].filter(Boolean).join(" ");
    main.appendChild(el("p", "paper-authors", authorsLine));

    const affilLine = [p.institution, p.country].filter(Boolean).join(", ");
    if (affilLine) main.appendChild(el("p", "paper-affil", affilLine));

    card.appendChild(main);

    const tags = el("div", "paper-tags");
    const kws = Array.isArray(p.keywords) ? p.keywords : [];
    kws.forEach(k => tags.appendChild(el("span", "tag", k)));
    card.appendChild(tags);

    return card;
  }

  function logItem(item, isLatest){
    const li = el("li", "log-item" + (isLatest ? " latest" : ""));
    li.appendChild(el("div", "log-date", item.date || ""));
    li.appendChild(el("div", "log-text", item.text || ""));
    return li;
  }

  async function load(){
    const titleEl = document.getElementById("page-title");
    const introEl = document.getElementById("page-intro");
    const papersEl = document.getElementById("papers");
    const logEl = document.getElementById("log-list");
    const root = document.getElementById("root");

    try{
      const res = await fetch("journal.json", { cache: "no-store" });
      if(!res.ok) throw new Error(`Failed to fetch journal.json (HTTP ${res.status})`);
      const data = await res.json();

      applySeededBackground(data.title || "Journal");

      document.title = data.title || "Journal";
      titleEl.textContent = data.title || "Journal";
      introEl.textContent = data.intro || "";

      papersEl.innerHTML = "";
      (data.entries || []).forEach(p => papersEl.appendChild(paperCard(p)));

      logEl.innerHTML = "";
      (data.updateLog || []).forEach((u, idx) => logEl.appendChild(logItem(u, idx === 0)));

    } catch(err){
      titleEl.textContent = "Journal";
      introEl.textContent = "Could not load journal content.";

      const box = el("div", "load-error");
      box.appendChild(el("div", "", "Error loading journal.json:"));
      box.appendChild(el("div", "", String(err && err.message ? err.message : err)));
      root.insertBefore(box, root.firstChild);
    }
  }

  document.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
