<!-- File: journal.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading…</title>

  <!-- FAVICON (STATIC) -->
  <link rel="icon" type="image/png" href="../../../favicon1.png" />

  <style>
    /* ===== Dark Technical Gradient Background (seeded variation) ===== */
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      color:#f5f5f5;

      --g1: rgba(80,120,255,0.12);
      --g2: rgba(0,200,180,0.08);
      --g3: rgba(255,80,120,0.06);
      --g3x: 55%;
      --g3y: 72%;

      --bgA: #0b0f1a;
      --bgB: #111827;
      --bgC: #0a0e17;

      background:
        radial-gradient(circle at 18% 20%, var(--g1), transparent 42%),
        radial-gradient(circle at 82% 28%, var(--g2), transparent 46%),
        radial-gradient(circle at var(--g3x) var(--g3y), var(--g3), transparent 48%),
        linear-gradient(135deg, var(--bgA), var(--bgB) 62%, var(--bgC));
      background-attachment: fixed;
    }

    /* ===== Top bar / back button (STATIC) ===== */
    .topbar{
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.25rem 1.5rem 0.25rem;
      display: flex;
      justify-content: flex-start;
    }

    a.back-btn{
      display:inline-block;
      text-decoration:none;
      font-weight:700;
      color:#eaf2ff;
      background: rgba(159,201,255,0.16);
      border: 1px solid rgba(159,201,255,0.28);
      padding: 0.75rem 1.05rem;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
    }

    a.back-btn:hover{
      border-color: rgba(159,201,255,0.42);
      background: rgba(159,201,255,0.22);
    }

    /* ===== Header ===== */
    header{
      padding: 1.25rem 1.5rem 1rem;
      text-align: center;
    }

    header h1{
      margin: 0 0 0.5rem 0;
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    header p{
      margin: 0;
      opacity: 0.9;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ===== Layout ===== */
    .container{
      max-width: 1100px;
      margin: 1.25rem auto 2.5rem;
      padding: 0 1.5rem 2rem;
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1.25rem;
      align-items: start;
    }

    @media (max-width: 960px){
      .container{ grid-template-columns: 1fr; }
      .topbar{ justify-content: center; }
    }

    /* ===== Sidebar card + Main wrapper look (same glass) ===== */
    .glass-card{
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 1.25rem;
      backdrop-filter: blur(6px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.28);
    }

    /* ===== Paper Cards (old format: main + tags on right) ===== */
    .papers{
      display: grid;
      gap: 1rem;
    }

    article.paper-card{
      display: flex;
      gap: 1rem;
      align-items: flex-start;

      background: rgba(255,255,255,0.14);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 12px;
      padding: 1rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.22);
    }

    .paper-main{
      flex: 1 1 auto;
      min-width: 0;
    }

    .paper-top-row{
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.65rem;
      gap: 0.75rem;
      font-size: 0.86rem;
      opacity: 0.95;
    }

    .paper-date{
      font-weight: 700;
      letter-spacing: 0.2px;
      opacity: 0.92;
      white-space: nowrap;
    }

    .paper-gist{
      margin: 0 0 0.55rem 0;
      font-size: 1.05rem;
      font-weight: 700;
      line-height: 1.25;
    }

    .paper-title{
      margin: 0 0 0.6rem 0;
      opacity: 0.9;
      line-height: 1.35;
    }

    .paper-authors{
      margin: 0;
      opacity: 0.9;
      font-size: 0.92rem;
      line-height: 1.35;
    }

    .paper-affil{
      margin: 0.25rem 0 0.6rem;
      opacity: 0.85;
      font-size: 0.9rem;
      line-height: 1.35;
    }

    /* Journal link at bottom of card */
    .paper-footer{
      margin-top: 0.75rem;
      display: flex;
      justify-content: flex-start;
    }

    .paper-footer a{
      color: #9fc9ff;
      font-weight: 700;
      text-decoration: none;
    }
    .paper-footer a:hover{ text-decoration: underline; }

    /* ===== Tags: right aligned + colored highlights ===== */
    .paper-tags{
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.55rem;
      margin-left: auto;
      min-width: 130px;
    }

    .tag{
      font-size: 0.78rem;
      padding: 0.3rem 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.10);
      opacity: 0.96;
      white-space: nowrap;
    }

    /* Colored category “feel” (method/device) */
    .tag.method{
      border-color: rgba(0,200,180,0.35);
      background: rgba(0,200,180,0.10);
      box-shadow: 0 0 0 1px rgba(0,200,180,0.08) inset;
    }

    .tag.device{
      border-color: rgba(159,201,255,0.38);
      background: rgba(159,201,255,0.12);
      box-shadow: 0 0 0 1px rgba(159,201,255,0.08) inset;
    }

    /* fallback for extra keywords */
    .tag.other{
      border-color: rgba(255,170,80,0.30);
      background: rgba(255,170,80,0.08);
      box-shadow: 0 0 0 1px rgba(255,170,80,0.06) inset;
    }

    /* ===== Update log (same idea as your snippet) ===== */
    .log-help{
      margin: 0 0 0.75rem 0;
      opacity: 0.85;
      font-size: 0.9rem;
      line-height: 1.35;
    }

    .log-list{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.55rem;
    }

    .log-item{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.06);
      border-radius: 10px;
      padding: 0.6rem 0.7rem;
      display: grid;
      grid-template-columns: 105px 1fr;
      gap: 0.75rem;
      align-items: start;
    }

    .log-item.latest{
      border-color: rgba(159, 201, 255, 0.20);
      background: rgba(159, 201, 255, 0.06);
    }

    .log-date{
      font-size: 0.82rem;
      font-weight: 800;
      opacity: 0.92;
      white-space: nowrap;
    }

    .log-text{
      font-size: 0.9rem;
      opacity: 0.92;
      line-height: 1.35;
    }

    /* ===== Small error box ===== */
    .load-error{
      background: rgba(255, 80, 80, 0.12);
      border: 1px solid rgba(255, 80, 80, 0.25);
      border-radius: 12px;
      padding: 1rem;
    }
  </style>
</head>
<body>

  <!-- TOP BUTTON (STATIC) -->
  <div class="topbar">
    <a class="back-btn" href="../../hub-page.html">Back to Research Hub</a>
  </div>

  <header>
    <h1 id="page-title">Loading…</h1>
    <p id="page-intro">Loading…</p>
  </header>

  <div class="container" id="root">
    <!-- Main list -->
    <main class="glass-card">
      <div class="papers" id="papers"></div>
    </main>

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="glass-card">
        <h2>Update log</h2>
        <p class="log-help">
          Latest updates appear at top. Edit manually as you add more papers.
        </p>
        <ul class="log-list" id="log-list"></ul>
      </div>
    </aside>
  </div>

<script>
  // ---------- Seeded background variation from JSON title ----------
  function hash32(str){
    let h = 0x811c9dc5; // FNV-1a
    for(let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 0x01000193);
    }
    return h >>> 0;
  }

  function mulberry32(seed){
    let t = seed >>> 0;
    return function(){
      t += 0x6D2B79F5;
      let x = Math.imul(t ^ (t >>> 15), 1 | t);
      x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
      return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
    };
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function rgba(r,g,b,a){ return `rgba(${r|0},${g|0},${b|0},${a})`; }
  function hexFromRGB(r,g,b){
    const toHex = n => n.toString(16).padStart(2,"0");
    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
  }

  function applySeededBackground(title){
    const seed = hash32(title || "Journal");
    const rand = mulberry32(seed);

    const r1 = clamp(35 + Math.floor(140 * rand()), 35, 185);
    const g1 = clamp(35 + Math.floor(140 * rand()), 35, 185);
    const b1 = clamp(35 + Math.floor(140 * rand()), 35, 200);

    const r2 = clamp(25 + Math.floor(150 * rand()), 25, 200);
    const g2 = clamp(25 + Math.floor(150 * rand()), 25, 210);
    const b2 = clamp(25 + Math.floor(150 * rand()), 25, 210);

    const r3 = clamp(35 + Math.floor(160 * rand()), 35, 210);
    const g3 = clamp(25 + Math.floor(170 * rand()), 25, 215);
    const b3 = clamp(35 + Math.floor(170 * rand()), 35, 220);
    const a3 = 0.045 + (rand() * 0.04);

    const g3x = Math.round(10 + rand() * 80);
    const g3y = Math.round(12 + rand() * 78);

    const base1 = { r: 7 + Math.floor(12 * rand()),  g: 9 + Math.floor(16 * rand()),  b: 16 + Math.floor(18 * rand()) };
    const base2 = { r: 10 + Math.floor(16 * rand()), g: 14 + Math.floor(20 * rand()), b: 26 + Math.floor(22 * rand()) };
    const base3 = { r: 6 + Math.floor(12 * rand()),  g: 8 + Math.floor(14 * rand()),  b: 14 + Math.floor(18 * rand()) };

    document.body.style.setProperty("--g1", rgba(r1,g1,b1,0.12));
    document.body.style.setProperty("--g2", rgba(r2,g2,b2,0.08));
    document.body.style.setProperty("--g3", rgba(r3,g3,b3,a3));
    document.body.style.setProperty("--g3x", g3x + "%");
    document.body.style.setProperty("--g3y", g3y + "%");

    document.body.style.setProperty("--bgA", hexFromRGB(base1.r, base1.g, base1.b));
    document.body.style.setProperty("--bgB", hexFromRGB(base2.r, base2.g, base2.b));
    document.body.style.setProperty("--bgC", hexFromRGB(base3.r, base3.g, base3.b));
  }

  function el(tag, className, text){
    const n = document.createElement(tag);
    if(className) n.className = className;
    if(text !== undefined && text !== null) n.textContent = text;
    return n;
  }

  function classifyTag(tagText, index){
    const t = String(tagText || "").toLowerCase();
    if(index === 0) return "method";  // first keyword like LPCVD/MOCVD/MBE
    if(index === 1) return "device";  // second keyword like Mobility/Hall/Vertical SBD
    if(t.includes("mocvd") || t.includes("lpcvd") || t.includes("mbe")) return "method";
    if(t.includes("mobility") || t.includes("sbd") || t.includes("device") || t.includes("hall")) return "device";
    return "other";
  }

  function paperCard(p){
    const card = el("article", "paper-card");

    const main = el("div", "paper-main");
    const top = el("div", "paper-top-row");
    top.appendChild(el("span", "paper-date", p.publishedDate || ""));
    // keep right side empty here (link is at bottom as requested)
    top.appendChild(el("span", "", ""));
    main.appendChild(top);

    main.appendChild(el("h3", "paper-gist", p.gist || ""));
    main.appendChild(el("p", "paper-title", p.title || ""));
    main.appendChild(el("p", "paper-authors", ((p.byline || "") + " et al.").trim()));
    if(p.affiliation) main.appendChild(el("p", "paper-affil", p.affiliation));

    const footer = el("div", "paper-footer");
    const a = document.createElement("a");
    a.href = p.link || "#";
    a.target = "_blank";
    a.rel = "noopener";
    a.textContent = "Journal page";
    footer.appendChild(a);
    main.appendChild(footer);

    const tagsWrap = el("div", "paper-tags");
    const kws = Array.isArray(p.keywords) ? p.keywords : [];
    kws.forEach((k, idx) => {
      const klass = classifyTag(k, idx);
      tagsWrap.appendChild(el("span", "tag " + klass, k));
    });

    card.appendChild(main);
    card.appendChild(tagsWrap);
    return card;
  }

  function logItem(item, isLatest){
    const li = el("li", "log-item" + (isLatest ? " latest" : ""));
    li.appendChild(el("div", "log-date", item.date || ""));
    li.appendChild(el("div", "log-text", item.text || ""));
    return li;
  }

  async function load(){
    const titleEl = document.getElementById("page-title");
    const introEl = document.getElementById("page-intro");
    const papersEl = document.getElementById("papers");
    const logEl = document.getElementById("log-list");
    const root = document.getElementById("root");

    try{
      const res = await fetch("journal.json", { cache: "no-store" });
      if(!res.ok) throw new Error(`Failed to fetch journal.json (HTTP ${res.status})`);
      const data = await res.json();

      applySeededBackground(data.title || "Journal");

      document.title = data.title || "Journal";
      titleEl.textContent = data.title || "Journal";
      introEl.textContent = data.intro || "";

      papersEl.innerHTML = "";
      (data.entries || []).forEach(p => papersEl.appendChild(paperCard(p)));

      logEl.innerHTML = "";
      (data.updateLog || []).forEach((u, idx) => logEl.appendChild(logItem(u, idx === 0)));

    } catch(err){
      titleEl.textContent = "Journal";
      introEl.textContent = "Could not load journal content.";

      const box = el("div", "load-error");
      box.appendChild(el("div", "", "Error loading journal.json:"));
      box.appendChild(el("div", "", String(err && err.message ? err.message : err)));
      root.insertBefore(box, root.firstChild);
    }
  }

  document.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
