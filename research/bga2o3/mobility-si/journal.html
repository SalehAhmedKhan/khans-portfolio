<!-- File: journal.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal Page</title>

    <!-- FAVICON (STATIC) -->
    <link rel="icon" type="image/png" href="../../../favicon1.png">

    <style>
        :root {
            /* Mobility-bgo aesthetic variables */
            --card-bg: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.14);
            --accent: #60a5fa;
            --accent-soft: rgba(96, 165, 250, 0.14);
            --text-main: #e5e7eb;
            --text-muted: rgba(229, 231, 235, 0.72);
            --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.35);
            --radius: 10px;

            /* Seeded gradient vars (computed from JSON title) */
            --rg1: rgba(255, 140, 80, 0.10);
            --rg2: rgba(120, 80, 255, 0.10);
            --lg1: #070a14;
            --lg2: #0b1228;
            --lg3: #070a14;

            /* Used to align sidebar card top with first paper card top */
            --sidebar-align-offset: 2.35rem;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                         Roboto, Helvetica, Arial, sans-serif;

            background:
                radial-gradient(circle at 18% 22%, var(--rg1), transparent 42%),
                radial-gradient(circle at 82% 28%, var(--rg2), transparent 46%),
                linear-gradient(140deg, var(--lg1) 0%, var(--lg2) 55%, var(--lg3) 100%);
            background-attachment: fixed;

            color: var(--text-main);
        }

        a { color: var(--accent); text-decoration: none; }
        a:hover { text-decoration: underline; }

        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1.25rem 2.5rem;
        }

        header.page-header { margin-bottom: 1.5rem; }

        .topic-label {
            font-size: 0.92rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .topic-title {
            font-size: clamp(1.9rem, 3vw, 2.4rem);
            font-weight: 700;
            margin: 0 0 0.25rem;
        }

        .topic-subtitle {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .back-btn {
            display: inline-block;
            margin-top: 0.7rem;
            margin-bottom: 1rem;

            font-size: 0.9rem;
            font-weight: 700;
            color: #eaf2ff;

            background: rgba(96, 165, 250, 0.14);
            border: 1px solid rgba(96, 165, 250, 0.26);
            border-radius: 10px;

            padding: 0.55rem 0.9rem;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(6px);
        }

        .back-btn:hover {
            text-decoration: none;
            background: rgba(96, 165, 250, 0.18);
            border-color: rgba(96, 165, 250, 0.38);
        }

        .layout {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }

        main { flex: 1.7; }
        aside.sidebar { flex: 0.9; }

        @media (max-width: 900px) {
            .layout { flex-direction: column; }
            aside.sidebar { order: -1; }
        }

        /* ===== UPDATE LOG ===== */
        .sidebar-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            padding: 1rem 1rem 0.75rem;
            border: 1px solid var(--border);

            /* align top edge with first paper card */
            margin-top: var(--sidebar-align-offset);
        }

        @media (max-width: 900px) {
            .sidebar-card { margin-top: 0; }
        }

        .sidebar-card h2 {
            font-size: 1rem;
            margin: 0 0 0.5rem;
        }

        /* REMOVED: log-help block entirely (you asked to lose that text) */
        .log-help { display: none; }

        .log-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .log-item {
            border-left: 2px solid var(--border);
            padding-left: 0.6rem;
            margin-bottom: 0.6rem;
        }

        .log-item.latest {
            border-left-color: var(--accent);
            background: var(--accent-soft);
            border-radius: 4px;
            padding: 0.45rem 0.55rem;
        }

        .log-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .log-text {
            font-size: 0.85rem;
        }

        /* ===== PAPER LIST ===== */
        .section-header {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .section-header h2 {
            margin: 0;
            font-size: 1.15rem;
        }

        .paper-list {
            display: flex;
            flex-direction: column;
            gap: 0.9rem;
        }

        /* Whole-card clickable wrapper */
        .paper-link {
            display: block;
            color: inherit;
            text-decoration: none;
            border-radius: var(--radius);
        }
        .paper-link:hover { text-decoration: none; }

        /* ===== PAPER CARD ===== */
        .paper-card {
            position: relative;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border);
            padding: 1rem 1rem;
            display: flex;
            gap: 1rem;
            align-items: stretch;
            transition: box-shadow 0.15s ease;
        }

        .paper-link:hover .paper-card {
            /* Constant, brighter glow edge on hover */
            box-shadow:
                0 10px 26px rgba(0, 0, 0, 0.45),
                0 0 0 1px rgba(96, 165, 250, 0.62),
                0 0 18px rgba(96, 165, 250, 0.22);
        }

        .paper-main { flex: 1; }

        .paper-top-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem 1rem;
            align-items: center;
            margin-bottom: 0.35rem;
        }

        .paper-date {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
        }

        .paper-gist {
            margin: 0.20rem 0 0.30rem;
            font-size: 1.02rem;
            font-weight: 600;
            line-height: 1.25;
        }

        .paper-title {
            margin: 0 0 0.30rem;
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.35;
        }

        .paper-authors {
            margin: 0 0 0.30rem;
            font-size: 0.83rem;
            color: var(--text-muted);
            line-height: 1.35;
        }

        .paper-affil {
            margin: 0;
            font-size: 0.83rem;
            color: var(--text-muted);
            line-height: 1.35;
        }

        /* Tags (right aligned) */
        .paper-tags {
            min-width: 140px;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            align-items: flex-end;
            justify-content: center;
        }

        @media (max-width: 700px) {
            .paper-card { flex-direction: column; }
            .paper-tags { align-items: flex-start; }
        }

        .tag {
            display: inline-block;
            padding: 0.18rem 0.45rem;
            border-radius: 999px;
            background: var(--accent-soft);
            color: var(--accent);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        /* Match your highlight palette */
        .tag.method { background: #fef3c7; color: #92400e; }
        .tag.device { background: #ecfdf3; color: #166534; }
        .tag.other  { background: #f3e8ff; color: #6b21a8; }
        .tag.other-blue { background: #dbeafe; color: #1d4ed8; }

        .paper-link:focus-visible {
            outline: 2px solid rgba(96,165,250,0.75);
            outline-offset: 4px;
            border-radius: calc(var(--radius) + 4px);
        }
    </style>
</head>

<body>
<div class="page">

    <header class="page-header">
        <div class="topic-label">Research Topic</div>
        <h1 class="topic-title" id="page-title"></h1>
        <p class="topic-subtitle" id="page-subtitle"></p>

        <a class="back-btn" href="../hub-page.html">Back to Research Hub</a>
    </header>

    <div class="layout">

        <main>
            <div class="section-header">
                <h2>Paper log</h2>
            </div>

            <div class="paper-list" id="paper-list"></div>
        </main>

        <aside class="sidebar">
            <div class="sidebar-card">
                <h2>Update log</h2>
                <p class="log-help">
                    Latest updates appear at top. Edit manually as you add more papers.
                </p>
                <ul class="log-list" id="log-list"></ul>
            </div>
        </aside>

    </div>
</div>

<script>
/* ===== Seeded gradient from JSON title (random but stable per title) ===== */
function hash32(str){
  let h = 0x811c9dc5;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 0x01000193);
  }
  return h >>> 0;
}
function mulberry32(seed){
  let t = seed >>> 0;
  return function(){
    t += 0x6D2B79F5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function rgba(r,g,b,a){ return `rgba(${r|0}, ${g|0}, ${b|0}, ${a})`; }
function hexFromRGB(r,g,b){
  const toHex = n => n.toString(16).padStart(2, "0");
  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
}
function applySeededGradient(title){
  const seed = hash32(title || "Journal");
  const rand = mulberry32(seed);

  const r1 = clamp(80  + Math.floor(160 * rand()), 60, 240);
  const g1 = clamp(60  + Math.floor(150 * rand()), 50, 230);
  const b1 = clamp(60  + Math.floor(150 * rand()), 50, 230);

  const r2 = clamp(60  + Math.floor(170 * rand()), 50, 245);
  const g2 = clamp(60  + Math.floor(170 * rand()), 50, 245);
  const b2 = clamp(80  + Math.floor(170 * rand()), 60, 255);

  const a1 = 0.08 + rand() * 0.05;
  const a2 = 0.08 + rand() * 0.05;

  const base1 = { r: 6 + Math.floor(10 * rand()), g: 8 + Math.floor(12 * rand()), b: 16 + Math.floor(18 * rand()) };
  const base2 = { r: 8 + Math.floor(12 * rand()), g: 10 + Math.floor(14 * rand()), b: 26 + Math.floor(20 * rand()) };
  const base3 = { r: 6 + Math.floor(10 * rand()), g: 8 + Math.floor(12 * rand()), b: 16 + Math.floor(18 * rand()) };

  document.documentElement.style.setProperty("--rg1", rgba(r1,g1,b1,a1));
  document.documentElement.style.setProperty("--rg2", rgba(r2,g2,b2,a2));
  document.documentElement.style.setProperty("--lg1", hexFromRGB(base1.r, base1.g, base1.b));
  document.documentElement.style.setProperty("--lg2", hexFromRGB(base2.r, base2.g, base2.b));
  document.documentElement.style.setProperty("--lg3", hexFromRGB(base3.r, base3.g, base3.b));
}

/* ===== Render helpers ===== */
function el(tag, className, text){
  const n = document.createElement(tag);
  if(className) n.className = className;
  if(text !== undefined && text !== null) n.textContent = text;
  return n;
}

/* Format ISO date -> "01 February 2025" */
function formatFullDate(iso){
  if(!iso) return "";
  const parts = String(iso).split("-");
  const y = Number(parts[0]);
  const m = Number(parts[1] || 1);
  const d = Number(parts[2] || 1);

  const dt = new Date(Date.UTC(y, m - 1, d));
  if (isNaN(dt.getTime())) return iso;

  const day = String(dt.getUTCDate()).padStart(2, "0");
  const monthName = dt.toLocaleString("en-US", { month: "long", timeZone: "UTC" });
  const year = dt.getUTCFullYear();
  return `${day} ${monthName} ${year}`;
}

/* Sort using real Date objects (newest first) */
function toSortableTime(iso){
  if(!iso) return -Infinity;
  const parts = String(iso).split("-");
  const y = Number(parts[0]);
  const m = Number(parts[1] || 1);
  const d = Number(parts[2] || 1);
  const t = Date.UTC(y, m - 1, d);
  return isNaN(t) ? -Infinity : t;
}

/* Build "First Author et. al. — Group" from byline "X — Group" */
function formatByline(byline){
  const raw = String(byline || "");
  const parts = raw.split("—");
  const author = (parts[0] || "").trim();
  const group = (parts[1] || "").trim();
  if(author && group) return `${author} et. al. — ${group}`;
  if(author) return `${author} et. al.`;
  return raw;
}

function classifyKeyword(idx){
  if(idx === 0) return "method";
  if(idx === 1) return "device";
  if(idx === 2) return "other";
  return "other-blue";
}

function safeURL(u){
  const url = String(u || "").trim();
  if(!url || url === "#") return "#";
  return url;
}

function renderPaperCard(p){
  const link = document.createElement("a");
  link.className = "paper-link";
  link.href = safeURL(p.link);
  link.target = "_blank";
  link.rel = "noopener";

  const card = el("article", "paper-card");
  const main = el("div", "paper-main");

  const top = el("div", "paper-top-row");
  top.appendChild(el("span", "paper-date", formatFullDate(p.publishedDate)));
  main.appendChild(top);

  main.appendChild(el("h3", "paper-gist", p.gist || ""));
  main.appendChild(el("p", "paper-title", p.title || ""));

  const authors = document.createElement("p");
  authors.className = "paper-authors";
  authors.textContent = formatByline(p.byline);
  main.appendChild(authors);

  if(p.affiliation) main.appendChild(el("p", "paper-affil", p.affiliation));

  const tags = el("div", "paper-tags");
  const kws = Array.isArray(p.keywords) ? p.keywords : [];
  kws.forEach((k, idx) => {
    tags.appendChild(el("span", "tag " + classifyKeyword(idx), k));
  });

  card.appendChild(main);
  card.appendChild(tags);
  link.appendChild(card);
  return link;
}

function renderLogItem(item, isLatest){
  const li = el("li", "log-item" + (isLatest ? " latest" : ""));
  li.appendChild(el("div", "log-date", item.date || ""));
  li.appendChild(el("div", "log-text", item.text || ""));
  return li;
}

async function load(){
  const titleEl = document.getElementById("page-title");
  const subtitleEl = document.getElementById("page-subtitle");
  const listEl = document.getElementById("paper-list");
  const logEl = document.getElementById("log-list");

  try{
    const res = await fetch("journal.json", { cache: "no-store" });
    if(!res.ok) throw new Error(`Failed to fetch journal.json (HTTP ${res.status})`);
    const data = await res.json();

    applySeededGradient(data.title || "Journal");

    document.title = data.title || document.title;
    titleEl.textContent = data.title || "";
    subtitleEl.textContent = data.intro || "";

    const entries = (data.entries || []).slice().sort((a,b) => toSortableTime(b.publishedDate) - toSortableTime(a.publishedDate));

    listEl.innerHTML = "";
    entries.forEach(p => listEl.appendChild(renderPaperCard(p)));

    logEl.innerHTML = "";
    (data.updateLog || []).forEach((u, idx) => logEl.appendChild(renderLogItem(u, idx === 0)));

  } catch(err){
    titleEl.textContent = "β-Ga₂O₃ Journal Notes";
    subtitleEl.textContent = "Could not load journal content.";
    listEl.innerHTML = "";
    logEl.innerHTML = "";
  }
}

document.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
